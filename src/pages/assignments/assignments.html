<main class="page-container" role="main">
  <header class="page-header">
    <section>
      <h1 class="page-title">Assignment Tracker</h1>
      <p class="page-subtitle">Manage and track all your assignments across courses</p>
    </section>
  </header>

  <!-- Statistics Overview -->
  <section class="stats-grid" aria-label="Assignment statistics">
    <app-card ariaLabel="Total assignments">
      <article class="stat-card">
        <p class="stat-value">{{ stats().total }}</p>
        <p class="stat-label">Total Assignments</p>
      </article>
    </app-card>

    <app-card ariaLabel="Pending assignments">
      <article class="stat-card status-pending">
        <p class="stat-value">{{ stats().pending }}</p>
        <p class="stat-label">Pending</p>
      </article>
    </app-card>

    <app-card ariaLabel="Submitted assignments">
      <article class="stat-card status-submitted">
        <p class="stat-value">{{ stats().submitted }}</p>
        <p class="stat-label">Submitted</p>
      </article>
    </app-card>

    <app-card ariaLabel="Graded assignments">
      <article class="stat-card status-graded">
        <p class="stat-value">{{ stats().graded }}</p>
        <p class="stat-label">Graded</p>
      </article>
    </app-card>

    <app-card ariaLabel="Overdue assignments">
      <article class="stat-card status-overdue">
        <p class="stat-value">{{ stats().overdue }}</p>
        <p class="stat-label">Overdue</p>
      </article>
    </app-card>
  </section>

  <!-- Filters and Controls -->
  <app-card ariaLabel="Filter controls">
    <section class="filters">
      <section class="filter-group">
        <label class="filter-label">Filter by Status:</label>
        <nav class="filter-buttons" aria-label="Status filter buttons">
          <button 
            class="filter-btn" 
            [class.active]="filterStatus() === 'all'"
            (click)="setFilter('all')">
            All
          </button>
          <button 
            class="filter-btn" 
            [class.active]="filterStatus() === 'pending'"
            (click)="setFilter('pending')">
            Pending
          </button>
          <button 
            class="filter-btn" 
            [class.active]="filterStatus() === 'submitted'"
            (click)="setFilter('submitted')">
            Submitted
          </button>
          <button 
            class="filter-btn" 
            [class.active]="filterStatus() === 'graded'"
            (click)="setFilter('graded')">
            Graded
          </button>
          <button 
            class="filter-btn" 
            [class.active]="filterStatus() === 'overdue'"
            (click)="setFilter('overdue')">
            Overdue
          </button>
        </nav>
      </section>

      <section class="filter-group">
        <label class="filter-label" for="course-filter">Filter by Course:</label>
        <select 
          id="course-filter"
          class="filter-select"
          [value]="filterCourse() || ''"
          (change)="setCourseFilter($any($event.target).value ? +$any($event.target).value : null)">
          <option value="">All Courses</option>
          @for (course of courses(); track course.id) {
            <option [value]="course.id">{{ course.code }} - {{ course.name }}</option>
          }
        </select>
      </section>

      <section class="filter-group">
        <label class="filter-label" for="sort-select">Sort by:</label>
        <select 
          id="sort-select"
          class="filter-select"
          [value]="sortBy()"
          (change)="setSortBy($any($event.target).value)">
          <option value="dueDate">Due Date</option>
          <option value="course">Course</option>
          <option value="status">Status</option>
        </select>
      </section>
    </section>
  </app-card>

  <!-- Assignments List -->
  <app-card ariaLabel="Assignments list">
    <section aria-labelledby="assignments-heading">
      <header class="panel-header">
        <h2 id="assignments-heading" class="panel-title">
          Assignments ({{ filteredAssignments().length }})
        </h2>
      </header>

      @if (filteredAssignments().length === 0) {
        <div class="empty-state">
          <p class="empty-title">No assignments found</p>
          <p class="empty-sub">Try adjusting your filters</p>
        </div>
      } @else {
        <div class="assignments-list" role="list" aria-label="Filtered assignments">
          @for (assignment of filteredAssignments(); track assignment.id) {
            <article class="assignment-card" [attr.data-status]="assignment.status" role="listitem">
              <div class="assignment-header">
                <div class="assignment-course">
                  <span 
                    class="course-badge" 
                    [style.background-color]="assignment.courseColor">
                    {{ assignment.courseCode }}
                  </span>
                  <span class="course-name">{{ assignment.courseName }}</span>
                </div>
                <span class="assignment-category">
                  {{ getCategoryIcon(assignment.category) }} {{ assignment.category }}
                </span>
              </div>

              <div class="assignment-main">
                <h3 class="assignment-name">{{ assignment.name }}</h3>
                @if (assignment.description) {
                  <p class="assignment-description">{{ assignment.description }}</p>
                }
              </div>

              <div class="assignment-details">
                <div class="detail-item">
                  <span class="detail-label">Due:</span>
                  <span class="detail-value due-date" [class.urgent]="getDaysUntilDue(assignment.dueDate) <= 2">
                    {{ formatDate(assignment.dueDate) }}
                    @if (getDaysUntilDue(assignment.dueDate) >= 0) {
                      <span class="days-until">({{ getDaysUntilDue(assignment.dueDate) }} days)</span>
                    }
                  </span>
                </div>

                <div class="detail-item">
                  <span class="detail-label">Points:</span>
                  <span class="detail-value">{{ assignment.pointsPossible }} pts ({{ assignment.weight }}% weight)</span>
                </div>

                <div class="detail-item">
                  <span class="detail-label">Grade:</span>
                  <span class="detail-value">{{ getGradeDisplay(assignment) }}</span>
                </div>

                <div class="detail-item">
                  <span class="detail-label">Status:</span>
                  <select 
                    class="status-select"
                    [class]="getStatusClass(assignment.status)"
                    [value]="assignment.status"
                    (change)="updateAssignmentStatus(assignment.id, assignment.courseId, $any($event.target).value)">
                    <option value="pending">Pending</option>
                    <option value="submitted">Submitted</option>
                    <option value="graded">Graded</option>
                    <option value="overdue">Overdue</option>
                  </select>
                </div>
              </div>
            </article>
          }
        </div>
      }
    </section>
  </app-card>
</main>
